## ğŸ… SantaPhone

SantaPhone is a festive demo that lets you place a simulated phone call to Santa Claus from your browser. The app establishes a WebRTC connection to the OpenAI Realtime API, streams your microphone audio to the model, and plays back Santa's voice in real time. It showcases how to combine Next.js, modern browser media APIs, and OpenAI's turn-detection features to build a natural-feeling conversational experience.ã€F:app/page.tsxâ€ L1-L210ã€‘ã€F:app/api/sdp/route.tsâ€ L1-L78ã€‘

### How it works

1. **Client UI** â€“ `app/page.tsx` renders a â€œphoneâ€ interface with call controls, microphone activity indicators, and optional debug logs.ã€F:app/page.tsxâ€ L21-L210ã€‘
2. **WebRTC setup** â€“ When you press call, the client creates a `RTCPeerConnection`, adds audio/video transceivers, and gathers ICE candidates. A data channel is opened to send session instructions (a Santa-themed system prompt, preferred voice, and turn-detection settings) and to receive debug messages.ã€F:app/page.tsxâ€ L29-L125ã€‘
3. **Microphone capture & VAD** â€“ After the initial greeting, the app captures microphone audio, replaces the negotiated sender track, and runs a lightweight RMS-based VAD to animate the â€œtalkingâ€ indicator.ã€F:app/page.tsxâ€ L127-L209ã€‘
4. **Server handshake** â€“ The gathered SDP offer is POSTed to the Next.js API route at `app/api/sdp/route.ts`, which forwards it to OpenAI's Realtime endpoint using the configured model and returns the SDP answer back to the browser.ã€F:app/api/sdp/route.tsâ€ L1-L78ã€‘

Together these pieces give you a low-latency, full-duplex voice chat with a pre-configured Santa persona defined in `lib/santaPrompt.ts`.

## Getting Started

### Prerequisites

- Node.js 18 or later (Next.js 15 requirement)
- An OpenAI API key with access to the Realtime models

### Installation

```bash
npm install
```

Create a `.env.local` file in the project root and set the OpenAI credentials:

```bash
OPENAI_API_KEY=sk-...
# Optional: override the default realtime model
```

### Running the dev server

```bash
npm run dev
```

Then open [http://localhost:3000](http://localhost:3000) in a Chromium-based browser and press the green call button. The browser will request microphone accessâ€”grant it to begin chatting. Toggle the â€œĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ»Ğ¾Ğ³â€ link to inspect the raw signalling and diagnostic messages during the call.ã€F:app/page.tsxâ€ L21-L210ã€‘

## Customization Tips

- **Prompt & persona:** Adjust Santa's behavior in `lib/santaPrompt.ts` to change what he says or how he behaves.
- **Voice & model:** Update the constants in `app/page.tsx` or set `OPENAI_REALTIME_MODEL` to try different realtime voices and models.ã€F:app/page.tsxâ€ L11-L76ã€‘ã€F:app/api/sdp/route.tsâ€ L16-L59ã€‘
- **Security:** For production deployments, restrict the allowed models list in `app/api/sdp/route.ts` or implement additional auth before exchanging SDP offers.ã€F:app/api/sdp/route.tsâ€ L16-L59ã€‘

## Deployment

Deploy like any standard Next.js 15 application (e.g., Vercel, Netlify, or a custom Node host). Ensure the `OPENAI_API_KEY` (and optional `OPENAI_REALTIME_MODEL`) environment variables are configured in the hosting platform so the API route can complete the handshake with OpenAI Realtime.ã€F:app/api/sdp/route.tsâ€ L24-L77ã€‘
